<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Redirecting...</title>
    <script>
      // Store the full path including the base path
      const path = window.location.pathname;
      // Get the base path (repository name)
      const basePath = '/bms-digital-signage'; // Make sure this matches your repo name
      // Extract the part of the path *after* the base path
      const spaPath = path.startsWith(basePath) ? path.substring(basePath.length) : path;
      
      // Redirect logic based on sessionStorage to avoid infinite loops
      let redirect = sessionStorage.redirect;
      delete sessionStorage.redirect;

      if (redirect && redirect === spaPath) {
        // If we are already redirecting to this path, stop to prevent loop
        console.warn("Redirect loop detected for path:", spaPath);
      } else {
        // Store the intended path and redirect to index.html
        sessionStorage.redirect = spaPath;
        // Construct the redirect URL correctly including the base path
        const redirectUrl = basePath + '/?p=' + encodeURIComponent(spaPath) + window.location.search + window.location.hash;
        console.log("Redirecting to:", redirectUrl);
        window.location.replace(redirectUrl);
      }
    </script>
  </head>
  <body>
    If you are not redirected automatically, please click <a id="redirect-link" href="#">here</a>.
    <script>
      // Update the link href just in case the script redirect fails
      const spaPathForLink = sessionStorage.redirect || '/'; // Fallback to root
      const linkUrl = basePath + '/?p=' + encodeURIComponent(spaPathForLink) + window.location.search + window.location.hash;
      document.getElementById('redirect-link').href = linkUrl;
    </script>
  </body>
</html>
